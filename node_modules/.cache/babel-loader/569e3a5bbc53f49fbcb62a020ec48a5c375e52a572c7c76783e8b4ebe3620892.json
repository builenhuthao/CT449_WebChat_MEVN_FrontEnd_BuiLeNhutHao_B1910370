{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport axios from \"axios\";\nimport swal from \"sweetalert2\";\nimport { io } from \"socket.io-client\";\nimport store from \"../../vuex/store\";\nexport default {\n  data() {\n    return {\n      login: false,\n      user: null,\n      // get value from search input field\n      query: \"\"\n    };\n  },\n  computed: {\n    unreadNotifications() {\n      return store.getters.getUnreadNotifications;\n    }\n  },\n  methods: {\n    doSearch: async function () {\n      // create form data object and add searched query in it\n      const formData = new FormData();\n      formData.append(\"query\", this.query);\n\n      // call an AJAX to the server\n      const response = await axios.post(this.$apiURL + \"/search\",\n      // send the form data object with the request\n      formData,\n      // pass headers that contains access token\n      // so the server will know which user's contact to search\n      {\n        headers: this.$headers\n      });\n      if (response.data.status == \"success\") {\n        // set the contacts array to the one received from API\n        store.commit(\"setContacts\", response.data.contacts);\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n    doLogout: async function () {\n      const response = await axios.post(this.$apiURL + \"/logout\", null, {\n        headers: this.$headers\n      });\n      localStorage.removeItem(this.$accessTokenKey);\n      this.$router.push({\n        path: \"/login\"\n      });\n    },\n    getUser: async function () {\n      const self = this;\n\n      // check if user is logged in\n      if (localStorage.getItem(this.$accessTokenKey)) {\n        const response = await axios.post(this.$apiURL + \"/getUser\", null, {\n          headers: this.$headers\n        });\n        if (response.data.status == \"success\") {\n          // user is logged in\n          this.$user = response.data.user;\n          store.commit(\"setUser\", response.data.user);\n          store.commit(\"setUnreadNotifications\", response.data.unreadNotifications);\n          store.commit(\"setNotifications\", response.data.user.notifications);\n          if (typeof socketIO !== \"undefined\") {\n            socketIO.emit(\"connected\", this.$user.email);\n            socketIO.on(\"sendMessage\", async function (data) {\n              if (self.$route.path == \"/chat/\" + data.data.sender.email) {\n                store.commit(\"appendMessage\", data.data);\n              }\n              let tempContacts = self.$user.contacts;\n              for (let a = 0; a < tempContacts.length; a++) {\n                if (tempContacts[a]._id == data.data.sender._id) {\n                  tempContacts[a].unreadMessages++;\n                }\n              }\n              store.commit(\"setContacts\", tempContacts);\n              const Toast = swal.mixin({\n                toast: true,\n                position: \"bottom-right\",\n                customClass: {\n                  popup: \"colored-toast\"\n                },\n                showConfirmButton: false,\n                timer: 10000,\n                timerProgressBar: true\n              });\n              await Toast.fire({\n                title: data.title\n              });\n            });\n          }\n        } else {\n          // user is logged out\n          localStorage.removeItem(this.$accessTokenKey);\n        }\n        this.login = localStorage.getItem(this.$accessTokenKey) != null;\n      } else {\n        this.login = false;\n      }\n      global.user = this.user;\n    }\n  },\n  computed: {\n    user() {\n      return store.getters.getUser;\n    }\n  },\n  mounted: function () {\n    this.getUser();\n    global.socketIO = io(this.$apiURL);\n  }\n};","map":{"version":3,"names":["axios","swal","io","store","data","login","user","query","computed","unreadNotifications","getters","getUnreadNotifications","methods","doSearch","formData","FormData","append","response","post","$apiURL","headers","$headers","status","commit","contacts","fire","message","doLogout","localStorage","removeItem","$accessTokenKey","$router","push","path","getUser","self","getItem","$user","notifications","socketIO","emit","email","on","$route","sender","tempContacts","a","length","_id","unreadMessages","Toast","mixin","toast","position","customClass","popup","showConfirmButton","timer","timerProgressBar","title","global","mounted"],"sources":["D:\\Laptrinh\\Phat_trien_ung_dung_web\\Projects\\Web-Chat\\CT449-WebChat-MEVN-FrontEnd-BuiLeNhutHao-B1910370\\src\\components\\layouts\\AppHeader.vue"],"sourcesContent":["<template>\n  <nav class=\"navbar navbar-expand-lg navbar-dark bg-primary\">\n    <div class=\"container-fluid\">\n      <router-link class=\"navbar-brand\" to=\"/\"> We Chat </router-link>\n\n      <button\n        class=\"navbar-toggler\"\n        type=\"button\"\n        data-bs-toggle=\"collapse\"\n        data-bs-target=\"#navbarColor01\"\n        aria-controls=\"navbarColor01\"\n        aria-expanded=\"false\"\n        aria-label=\"Toggle navigation\"\n      >\n        <span class=\"navbar-toggler-icon\"></span>\n      </button>\n\n      <div class=\"collapse navbar-collapse\" id=\"navbarColor01\">\n        <ul class=\"navbar-nav me-auto\">\n          <li class=\"nav-item\">\n            <router-link class=\"nav-link active\" to=\"/\"> Home </router-link>\n          </li>\n\n          <li class=\"nav-item\" v-if=\"!login\">\n            <router-link class=\"nav-link\" to=\"/login\">Login</router-link>\n          </li>\n\n          <li class=\"nav-item\" v-if=\"!login\">\n            <router-link class=\"nav-link\" to=\"/register\">Register</router-link>\n          </li>\n\n          <li class=\"nav-item dropdown\" v-if=\"login\">\n            <a\n              v-text=\"user.name\"\n              class=\"nav-link dropdown-toggle\"\n              href=\"#\"\n              id=\"navbarDropdown\"\n              role=\"button\"\n              data-toggle=\"dropdown\"\n              aria-haspopup=\"true\"\n              aria-expanded=\"false\"\n            ></a>\n            <div class=\"dropdown-menu\" aria-labelledby=\"navbarDropdown\">\n              <li>\n                <router-link to=\"/profile\" class=\"dropdown-item\"\n                  >Profile</router-link\n                >\n              </li>\n\n              <li>\n                <a\n                  class=\"dropdown-item\"\n                  v-on:click=\"doLogout\"\n                  href=\"javascript:void(0);\"\n                  >Logout</a\n                >\n              </li>\n            </div>\n          </li>\n\n          <li class=\"nav-item\" v-if=\"login\">\n            <router-link class=\"nav-link\" to=\"/notifications\">\n              <i class=\"fa fa-bell\"></i>\n              <span\n                class=\"badge\"\n                v-if=\"unreadNotifications > 0\"\n                v-text=\"unreadNotifications\"\n              ></span>\n            </router-link>\n          </li>\n        </ul>\n\n        <form class=\"d-flex\" v-on:submit.prevent=\"doSearch\" v-if=\"false\">\n          <input\n            class=\"form-control me-sm-2\"\n            type=\"text\"\n            v-model=\"query\"\n            placeholder=\"Search\"\n          />\n          <button class=\"btn btn-secondary my-2 my-sm-0\" type=\"submit\">\n            Search\n          </button>\n        </form>\n      </div>\n    </div>\n  </nav>\n</template>\n\n<script>\nimport axios from \"axios\";\nimport swal from \"sweetalert2\";\nimport { io } from \"socket.io-client\";\nimport store from \"../../vuex/store\";\n\nexport default {\n  data() {\n    return {\n      login: false,\n      user: null,\n\n      // get value from search input field\n      query: \"\",\n    };\n  },\n\n  computed: {\n    unreadNotifications() {\n      return store.getters.getUnreadNotifications;\n    },\n  },\n\n  methods: {\n    doSearch: async function () {\n      // create form data object and add searched query in it\n      const formData = new FormData();\n      formData.append(\"query\", this.query);\n\n      // call an AJAX to the server\n      const response = await axios.post(\n        this.$apiURL + \"/search\",\n\n        // send the form data object with the request\n        formData,\n\n        // pass headers that contains access token\n        // so the server will know which user's contact to search\n        {\n          headers: this.$headers,\n        }\n      );\n\n      if (response.data.status == \"success\") {\n        // set the contacts array to the one received from API\n        store.commit(\"setContacts\", response.data.contacts);\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n\n    doLogout: async function () {\n      const response = await axios.post(this.$apiURL + \"/logout\", null, {\n        headers: this.$headers,\n      });\n\n      localStorage.removeItem(this.$accessTokenKey);\n\n      this.$router.push({\n        path: \"/login\",\n      });\n    },\n\n    getUser: async function () {\n      const self = this;\n\n      // check if user is logged in\n      if (localStorage.getItem(this.$accessTokenKey)) {\n        const response = await axios.post(this.$apiURL + \"/getUser\", null, {\n          headers: this.$headers,\n        });\n\n        if (response.data.status == \"success\") {\n          // user is logged in\n          this.$user = response.data.user;\n\n          store.commit(\"setUser\", response.data.user);\n          store.commit(\n            \"setUnreadNotifications\",\n            response.data.unreadNotifications\n          );\n          store.commit(\"setNotifications\", response.data.user.notifications);\n\n          if (typeof socketIO !== \"undefined\") {\n            socketIO.emit(\"connected\", this.$user.email);\n\n            socketIO.on(\"sendMessage\", async function (data) {\n              if (self.$route.path == \"/chat/\" + data.data.sender.email) {\n                store.commit(\"appendMessage\", data.data);\n              }\n\n              let tempContacts = self.$user.contacts;\n              for (let a = 0; a < tempContacts.length; a++) {\n                if (tempContacts[a]._id == data.data.sender._id) {\n                  tempContacts[a].unreadMessages++;\n                }\n              }\n              store.commit(\"setContacts\", tempContacts);\n\n              const Toast = swal.mixin({\n                toast: true,\n                position: \"bottom-right\",\n                customClass: {\n                  popup: \"colored-toast\",\n                },\n                showConfirmButton: false,\n                timer: 10000,\n                timerProgressBar: true,\n              });\n\n              await Toast.fire({\n                title: data.title,\n              });\n            });\n          }\n        } else {\n          // user is logged out\n          localStorage.removeItem(this.$accessTokenKey);\n        }\n\n        this.login = localStorage.getItem(this.$accessTokenKey) != null;\n      } else {\n        this.login = false;\n      }\n\n      global.user = this.user;\n    },\n  },\n\n  computed: {\n    user() {\n      return store.getters.getUser;\n    },\n  },\n\n  mounted: function () {\n    this.getUser();\n\n    global.socketIO = io(this.$apiURL);\n  },\n};\n</script>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}